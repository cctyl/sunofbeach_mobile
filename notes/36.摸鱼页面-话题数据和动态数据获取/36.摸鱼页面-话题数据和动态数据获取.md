## 1.说明

<!--(补充一下，其实系统中包含了很多细小的bug，这些bug一般在添加新功能的时候我顺手就修复了，但是没有单独的写在文章里，所以要是发现页面效果和之前所说的不一致，那是因为我做了一些微调，改动不会很大，可以自己参考代码进行调整。)-->

本节，就是将话题以及摸鱼的数据获取，填充到页面中渲染



## 2.话题数据

话题总共有两个接口，一个是热门话题接口，一个是全部话题接口。两者返回的数据格式是不一致的。

- 热门话题

  `GET /ct/moyu/topic/index`

  响应如下：

  ```json
  {
      "success": true,
      "code": 10000,
      "message": "获取话题成功.",
      "data": [
          {
              "id": "1384189862646657025",
              "topicName": "代码之美",
              "followCount": 0,
              "contentCount": 0,
              "cover": null,
              "order": 0,
              "description": null,
              "createTime": null,
              "updateTime": null
          }
      ]
  }
  ```

- 全部话题

  `GET /ct/moyu/topic`

  响应如下：

  ```json
  {
      "success": true,
      "code": 10000,
      "message": "获取话题列表成功.",
      "data": [
          {
              "id": "1384518752720130050",
              "topicName": "划水摸鱼",
              "cover": "https://images.sunofbeaches.com/web/2021_04_30/837809810287099904.png",
              "followCount": 0,
              "contentCount": 440,
              "hasFollowed": false,
              "description": "上班时间的额外骚操作"
          }
      ]
  }
  ```



我们选哪个呢？小孩子才做选择，我们全都要。这个为什么全都要呢，主要是热门话题是需要展示在前面的，剩下的才是普通话题。

这里就涉及到一个去重操作，全部话题中必定包含热门话题，但是我们需要的是全部话题的格式，而不要热门话题的格式，所以热门话题接口返回的数据我们取出id之后，就可以抛弃了，接下来对全部话题数据做个不优雅的排序。排序的目的：`根据热门话题的id找出热门话题,然后把这些热门话题移动到前面`。有多种实现方式哈，只要能达成这个目的的都可以，我提供两种思路（两种思路都需要先拿到热门话题的id）：

- 思路1：

  遍历全部话题，加上一个orderNo 属性，只要id是热门话题的id中的一个，就让orderNo大于0。其他普通话题orderNo全是0.

  遍历第一次之后，再进行一次排序，根据orderNo 降序排序，这样得到结果必定是热门话题在前。

- 思路2：

  过滤全部话题，找到其中的热门话题，添加到 hotTopic，其他普通话题，添加到 commonTopic。（到这里经历完一次循环）

  然后把hotTopic和commomTopic 链接起来，让hotTopic在前，可以使用`hotTopic.concat(commonTopic)`。这样hotTopic必定在前面，就实现了热门话题在前的效果。

- 其他思路：

  话题中有个followCount 以及contentCount，如果说热门话题就是根据这两个来来排序的，那么大可只获取全部话题，然后根据这个排序。当然，一般是后端查询时就根据这个排序查好再返回，这里不提

具体代码如下：

```js
   /**
   * 获取动态话题列表
   */
async getMomentTopicList() {
    let allTopicResult = await api.getMoyuAllTopic()
    let hotTopicResult = await api.getMoyuHotTopic()

    let allTopicList = allTopicResult.data

    console.log(hotTopicResult)
    console.log(allTopicResult)

    //从allTopicList中找到hotTopicList的数据
    //为什么要这么做呢，是因为hotTopicList中数据格式和allTopicList中数据格式不一致
    let hotTopicIds = hotTopicResult.data.map(currentValue => currentValue.id)


    //在allTopicList中的hotTopic
    let hotInAll = []

    //去除了hotTopic的剩余topic
    let hotNotInAll = []

    //分类
    allTopicList.forEach(item => {
        if (hotTopicIds.includes(item.id)) {
            hotInAll.push(item)
        } else {
            hotNotInAll.push(item)
        }
    })

    //将hotInAll插入到hotNotInAll前面
    this.categoryList = hotInAll.concat(hotNotInAll)


},
```

我们最后拿到的数据都塞进了categoryList，html只需要拿着这个categoryList去遍历，然后取出里面的每个item的数据即可。

在遍历的时候注意，有两个话题是不在全部话题里面的，一个叫做 '推荐' 一个叫做`关注`，关注必须登录后才会显示。这两个东西我们就写死成一个html标签即可，后面做切换标签时会说到。

